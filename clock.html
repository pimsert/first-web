<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบแสดงข้อมูลห้องสอบ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap');
        
        body {
            font-family: 'Sarabun', sans-serif;
        }
        
        .clock-face {
            width: 200px;
            height: 200px;
            border: 8px solid #333;
            border-radius: 50%;
            position: relative;
            background: white;
        }
        
        .clock-hand {
            position: absolute;
            background: #333;
            transform-origin: bottom center;
            left: 50%;
        }
        
        .hour-hand {
            width: 6px;
            height: 60px;
            margin-left: -3px;
            bottom: 50%;
        }
        
        .minute-hand {
            width: 4px;
            height: 80px;
            margin-left: -2px;
            bottom: 50%;
        }
        
        .second-hand {
            width: 2px;
            height: 90px;
            margin-left: -1px;
            bottom: 50%;
            background: red;
        }
        
        .center-dot {
            width: 12px;
            height: 12px;
            background: #333;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .clock-number {
            position: absolute;
            font-weight: bold;
            font-size: 16px;
        }
        
        .flash {
            animation: flash 1s infinite;
        }
        
        @keyframes flash {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        .digital-time {
            font-family: 'Courier New', monospace;
            font-size: 4rem;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body class="min-h-screen transition-colors duration-500" id="mainBody">
    <div class="container mx-auto p-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="flex justify-end mb-4">
                <div class="flex bg-gray-200 rounded-lg p-1">
                    <button onclick="setLanguage('th')" id="langTh" class="px-4 py-2 rounded-md bg-blue-600 text-white font-medium transition-colors">
                        ไทย
                    </button>
                    <button onclick="setLanguage('en')" id="langEn" class="px-4 py-2 rounded-md text-gray-600 font-medium transition-colors hover:bg-gray-300">
                        English
                    </button>
                </div>
            </div>
            <h1 class="text-4xl font-bold text-gray-800 mb-4" data-lang-th="ระบบแสดงข้อมูลห้องสอบ" data-lang-en="Exam Room Information System">ระบบแสดงข้อมูลห้องสอบ</h1>
        </div>

        <!-- Settings Panel -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-semibold mb-4 text-gray-700" data-lang-th="ตั้งค่าข้อมูลการสอบ" data-lang-en="Exam Settings">ตั้งค่าข้อมูลการสอบ</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-lang-th="รหัสวิชา" data-lang-en="Course Code">รหัสวิชา</label>
                    <input type="text" id="courseCode" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" data-placeholder-th="เช่น CS101" data-placeholder-en="e.g. CS101" placeholder="เช่น CS101">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-lang-th="ชื่อรายวิชา" data-lang-en="Course Name">ชื่อรายวิชา</label>
                    <input type="text" id="courseName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" data-placeholder-th="เช่น คณิตศาสตร์พื้นฐาน" data-placeholder-en="e.g. Basic Mathematics" placeholder="เช่น คณิตศาสตร์พื้นฐาน">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-lang-th="หมู่เรียน" data-lang-en="Section">หมู่เรียน</label>
                    <input type="text" id="courseSection" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" data-placeholder-th="เช่น หมู่ 1" data-placeholder-en="e.g. Section 1" placeholder="เช่น หมู่ 1">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-lang-th="ห้องสอบ" data-lang-en="Exam Room">ห้องสอบ</label>
                    <input type="text" id="examRoom" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" data-placeholder-th="เช่น ห้อง 301" data-placeholder-en="e.g. Room 301" placeholder="เช่น ห้อง 301">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-lang-th="เวลาเริ่มสอบ" data-lang-en="Start Time">เวลาเริ่มสอบ</label>
                    <input type="time" id="startTime" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-lang-th="ระยะเวลาสอบ (ชั่วโมง)" data-lang-en="Duration (Hours)">ระยะเวลาสอบ (ชั่วโมง)</label>
                    <input type="number" id="examHours" min="0" max="8" value="2" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-lang-th="ระยะเวลาสอบ (นาที)" data-lang-en="Duration (Minutes)">ระยะเวลาสอบ (นาที)</label>
                    <input type="number" id="examMinutes" min="0" max="59" value="0" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-lang-th="เวลาสิ้นสุด" data-lang-en="End Time">เวลาสิ้นสุด</label>
                    <input type="time" id="endTime" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" readonly>
                </div>
            </div>
            
            <!-- Additional Information -->
            <div class="mt-6">
                <label class="block text-sm font-medium text-gray-700 mb-2" data-lang-th="ข้อมูลเพิ่มเติมอื่นๆที่จะแจ้งให้นิสิตทราบในห้องสอบ" data-lang-en="Additional Information for Students">ข้อมูลเพิ่มเติมอื่นๆที่จะแจ้งให้นิสิตทราบในห้องสอบ</label>
                <textarea id="additionalInfo" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" data-placeholder-th="เช่น ห้ามใช้เครื่องคิดเลข, อนุญาตให้ใช้พจนานุกรม, ฯลฯ" data-placeholder-en="e.g. No calculators allowed, Dictionary permitted, etc." placeholder="เช่น ห้ามใช้เครื่องคิดเลข, อนุญาตให้ใช้พจนานุกรม, ฯลฯ"></textarea>
            </div>
            
            <!-- Alert Settings -->
            <div class="mt-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-700" data-lang-th="ตั้งค่าช่วงเวลาแจ้งเตือน" data-lang-en="Alert Settings">ตั้งค่าช่วงเวลาแจ้งเตือน</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-green-700 mb-2" data-lang-th="แจ้งเตือนที่ 1 (สีเขียว) - นาทีสุดท้าย" data-lang-en="Alert 1 (Green) - Minutes Remaining">แจ้งเตือนที่ 1 (สีเขียว) - นาทีสุดท้าย</label>
                        <input type="number" id="alert1" min="1" max="180" value="60" class="w-full p-3 border border-green-300 rounded-lg focus:ring-2 focus:ring-green-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-yellow-700 mb-2" data-lang-th="แจ้งเตือนที่ 2 (สีเหลือง) - นาทีสุดท้าย" data-lang-en="Alert 2 (Yellow) - Minutes Remaining">แจ้งเตือนที่ 2 (สีเหลือง) - นาทีสุดท้าย</label>
                        <input type="number" id="alert2" min="1" max="60" value="15" class="w-full p-3 border border-yellow-300 rounded-lg focus:ring-2 focus:ring-yellow-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-red-700 mb-2" data-lang-th="แจ้งเตือนที่ 3 (สีแดง) - นาทีสุดท้าย" data-lang-en="Alert 3 (Red) - Minutes Remaining">แจ้งเตือนที่ 3 (สีแดง) - นาทีสุดท้าย</label>
                        <input type="number" id="alert3" min="1" max="30" value="5" class="w-full p-3 border border-red-300 rounded-lg focus:ring-2 focus:ring-red-500">
                    </div>
                </div>
            </div>
            
            <!-- Clock Type Selection -->
            <div class="mt-6">
                <h3 class="text-lg font-semibold mb-4 text-gray-700" data-lang-th="รูปแบบการแสดงเวลา" data-lang-en="Clock Display Type">รูปแบบการแสดงเวลา</h3>
                <div class="flex gap-4">
                    <label class="flex items-center">
                        <input type="radio" name="clockType" value="digital" checked class="mr-2">
                        <span data-lang-th="นาฬิกาดิจิตอล (เวลาที่เหลือ)" data-lang-en="Digital Clock (Time Remaining)">นาฬิกาดิจิตอล (เวลาที่เหลือ)</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="clockType" value="analog" class="mr-2">
                        <span data-lang-th="นาฬิกาอนาล็อก (เวลาจริง)" data-lang-en="Analog Clock (Current Time)">นาฬิกาอนาล็อก (เวลาจริง)</span>
                    </label>
                </div>
            </div>
            
            <div class="mt-6">
                <button onclick="showFullScreen()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition-colors" data-lang-th="แสดงแบบเต็มจอ" data-lang-en="Show Full Screen">
                    แสดงแบบเต็มจอ
                </button>
            </div>
        </div>

        <!-- Full Screen Display -->
        <div id="fullScreenDisplay" class="fixed inset-0 z-50 hidden bg-green-800" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;">
            <div class="h-full flex flex-col">
                <!-- Back Button and Clock Mode Toggle -->
                <div class="absolute top-4 left-4 z-50 flex gap-4">
                    <button onclick="hideFullScreen()" class="bg-black bg-opacity-70 hover:bg-opacity-90 text-white font-bold py-3 px-6 rounded-lg transition-all shadow-lg" data-lang-th="← กลับไปแก้ไข" data-lang-en="← Back to Settings">
                        ← กลับไปแก้ไข
                    </button>
                    <button onclick="toggleClockMode()" class="bg-blue-600 bg-opacity-80 hover:bg-blue-700 hover:bg-opacity-90 text-white font-bold py-3 px-6 rounded-lg transition-all shadow-lg">
                        <span id="clockModeToggleText" data-lang-th="เปลี่ยนเป็นอนาล็อก" data-lang-en="Switch to Analog">เปลี่ยนเป็นอนาล็อก</span>
                    </button>
                </div>
                
                <!-- Full Screen Content -->
                <div class="flex-1 flex justify-center items-center p-8">
                    
                    <!-- Full Screen Digital Clock -->
                    <div id="fullScreenDigitalClock" class="w-full text-center">
                        <!-- Alert Message Above Timer -->
                        <div id="fullScreenAlertMessage" class="text-4xl font-bold p-8 rounded-lg mb-8 hidden drop-shadow-lg"></div>
                        
                        <div class="mb-16">
                            <p id="timeRemainingHeader" class="text-5xl text-white mb-8 drop-shadow-lg" data-lang-th="เวลาสอบที่เหลืออยู่" data-lang-en="Time Remaining">เวลาสอบที่เหลืออยู่</p>
                            <div id="fullScreenTimeRemaining" class="font-bold text-white drop-shadow-lg mb-16" style="font-family: 'Courier New', monospace; font-size: 12rem;"></div>
                        </div>
                        
                        <div class="space-y-8">
                            <div class="text-4xl text-white drop-shadow-lg">
                                <span data-lang-th="รหัสวิชา" data-lang-en="Course Code">รหัสวิชา</span> <span id="fullScreenCourseCode" class="font-semibold"></span> <span data-lang-th="ชื่อวิชา" data-lang-en="Course Name">ชื่อวิชา</span> <span id="fullScreenCourseName" class="font-semibold"></span>
                            </div>
                            <div class="text-4xl text-white drop-shadow-lg">
                                <span data-lang-th="หมู่เรียน" data-lang-en="Section">หมู่เรียน</span> <span id="fullScreenCourseSection" class="font-semibold"></span>
                            </div>
                            <div class="text-4xl text-white drop-shadow-lg">
                                <span data-lang-th="ห้องสอบ" data-lang-en="Exam Room">ห้องสอบ</span> <span id="fullScreenRoom" class="font-semibold"></span>
                            </div>
                            <div class="text-5xl text-white drop-shadow-lg font-semibold">
                                <span data-lang-th="ช่วงเวลาสอบ" data-lang-en="Exam Time">ช่วงเวลาสอบ</span> <span id="fullScreenStartTime"></span> - <span id="fullScreenEndTime"></span> <span data-lang-th="น." data-lang-en="">น.</span>
                            </div>
                            <div id="fullScreenAdditionalInfo" class="text-3xl text-yellow-200 drop-shadow-lg mt-8 p-6 bg-black bg-opacity-30 rounded-lg hidden"></div>
                        </div>
                    </div>
                    
                    <!-- Full Screen Analog Clock -->
                    <div id="fullScreenAnalogClock" class="w-full hidden">
                        <!-- Alert Message Above Timer for Analog -->
                        <div id="fullScreenAlertMessageAnalog" class="text-4xl font-bold p-8 rounded-lg mb-8 hidden drop-shadow-lg text-center"></div>
                        
                        <div class="grid grid-cols-2 gap-16 items-center h-full">
                            <!-- Left Column - Info -->
                            <div class="space-y-8">
                                <div class="text-center mb-16">
                                    <p id="timeRemainingHeaderAnalog" class="text-5xl text-white mb-8 drop-shadow-lg" data-lang-th="เวลาสอบที่เหลืออยู่" data-lang-en="Time Remaining">เวลาสอบที่เหลืออยู่</p>
                                    <div id="fullScreenTimeRemainingAnalog" class="font-bold text-white drop-shadow-lg mb-16" style="font-family: 'Courier New', monospace; font-size: 8rem;"></div>
                                </div>
                                
                                <div class="text-4xl text-white drop-shadow-lg">
                                    <span data-lang-th="รหัสวิชา" data-lang-en="Course Code">รหัสวิชา</span> <span id="fullScreenCourseCodeAnalog" class="font-semibold"></span> <span data-lang-th="ชื่อวิชา" data-lang-en="Course Name">ชื่อวิชา</span> <span id="fullScreenCourseNameAnalog" class="font-semibold"></span>
                                </div>
                                <div class="text-4xl text-white drop-shadow-lg">
                                    <span data-lang-th="หมู่เรียน" data-lang-en="Section">หมู่เรียน</span> <span id="fullScreenCourseSectionAnalog" class="font-semibold"></span>
                                </div>
                                <div class="text-4xl text-white drop-shadow-lg">
                                    <span data-lang-th="ห้องสอบ" data-lang-en="Exam Room">ห้องสอบ</span> <span id="fullScreenRoomAnalog" class="font-semibold"></span>
                                </div>
                                <div class="text-4xl text-white drop-shadow-lg font-semibold">
                                    <span data-lang-th="ช่วงเวลาสอบ" data-lang-en="Exam Time">ช่วงเวลาสอบ</span> <span id="fullScreenStartTimeAnalog"></span> - <span id="fullScreenEndTimeAnalog"></span> <span data-lang-th="น." data-lang-en="">น.</span>
                                </div>
                                <div id="fullScreenAdditionalInfoAnalog" class="text-2xl text-yellow-200 drop-shadow-lg mt-6 p-4 bg-black bg-opacity-30 rounded-lg hidden"></div>
                            </div>
                            
                            <!-- Right Column - Clock -->
                            <div class="flex flex-col justify-center items-center">
                                <div class="clock-face bg-white" id="fullScreenClockFace" style="width: 400px; height: 400px; border: 16px solid white;">
                                    <div class="clock-number" style="top: 20px; left: 50%; transform: translateX(-50%); font-size: 32px;">12</div>
                                    <div class="clock-number" style="top: 50%; right: 20px; transform: translateY(-50%); font-size: 32px;">3</div>
                                    <div class="clock-number" style="bottom: 20px; left: 50%; transform: translateX(-50%); font-size: 32px;">6</div>
                                    <div class="clock-number" style="top: 50%; left: 20px; transform: translateY(-50%); font-size: 32px;">9</div>
                                    
                                    <div class="clock-hand hour-hand" id="fullScreenHourHand" style="width: 12px; height: 120px; margin-left: -6px;"></div>
                                    <div class="clock-hand minute-hand" id="fullScreenMinuteHand" style="width: 8px; height: 160px; margin-left: -4px;"></div>
                                    <div class="clock-hand second-hand" id="fullScreenSecondHand" style="width: 4px; height: 180px; margin-left: -2px;"></div>
                                    <div class="center-dot" style="width: 24px; height: 24px;"></div>
                                </div>
                                <div class="mt-8 text-center">
                                    <p class="text-3xl text-white mb-4 drop-shadow-lg" data-lang-th="เวลาปัจจุบัน" data-lang-en="Current Time">เวลาปัจจุบัน</p>
                                    <div id="fullScreenCurrentTime" class="text-5xl font-bold text-white drop-shadow-lg"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                

                
                <!-- Full Screen End Message -->
                <div id="fullScreenEndMessage" class="absolute inset-0 flex flex-col justify-center items-center hidden">
                    <div id="examEndText" class="font-bold text-red-300 p-12 rounded-lg drop-shadow-lg text-center flash mb-16" style="font-size: 5rem; line-height: 1.2;" data-lang-th="หมดเวลาทำข้อสอบแล้ว<br>วางปากกาและส่งข้อสอบได้" data-lang-en="Time's Up!<br>Please stop writing and submit your exam">
                        หมดเวลาทำข้อสอบแล้ว<br>วางปากกาและส่งข้อสอบได้
                    </div>
                    <button onclick="endExam()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-4 px-8 rounded-lg text-2xl transition-colors shadow-lg" data-lang-th="สิ้นสุดการตั้งเวลาสอบ" data-lang-en="End Exam Timer">
                        สิ้นสุดการตั้งเวลาสอบ
                    </button>
                </div>
            </div>
        </div>

        <!-- Exam Display -->
        <div id="examDisplay" class="bg-white rounded-lg shadow-lg p-8 text-center hidden">
            <div class="mb-8">
                <h2 id="displayCourseCode" class="text-3xl font-bold text-gray-800 mb-2"></h2>
                <h3 id="displayCourseName" class="text-2xl text-gray-600 mb-4"></h3>
                <p id="displayRoom" class="text-xl text-gray-500"></p>
            </div>
            
            <div class="mb-8">
                <p class="text-lg text-gray-600 mb-2">เวลาเริ่มสอบ: <span id="displayStartTime" class="font-semibold"></span></p>
                <p class="text-lg text-gray-600">เวลาสิ้นสุด: <span id="displayEndTime" class="font-semibold"></span></p>
            </div>
            
            <!-- Digital Clock -->
            <div id="digitalClock" class="mb-8">
                <p class="text-xl text-gray-600 mb-4">เวลาที่เหลือ</p>
                <div id="timeRemaining" class="digital-time text-blue-600"></div>
            </div>
            
            <!-- Analog Clock -->
            <div id="analogClock" class="mb-8 hidden flex justify-center">
                <div class="clock-face" id="clockFace">
                    <div class="clock-number" style="top: 10px; left: 50%; transform: translateX(-50%);">12</div>
                    <div class="clock-number" style="top: 50%; right: 10px; transform: translateY(-50%);">3</div>
                    <div class="clock-number" style="bottom: 10px; left: 50%; transform: translateX(-50%);">6</div>
                    <div class="clock-number" style="top: 50%; left: 10px; transform: translateY(-50%);">9</div>
                    
                    <div class="clock-hand hour-hand" id="hourHand"></div>
                    <div class="clock-hand minute-hand" id="minuteHand"></div>
                    <div class="clock-hand second-hand" id="secondHand"></div>
                    <div class="center-dot"></div>
                </div>
                <div class="ml-8">
                    <p class="text-xl text-gray-600 mb-2">เวลาปัจจุบัน</p>
                    <div id="currentTime" class="text-2xl font-bold text-gray-800"></div>
                </div>
            </div>
            
            <!-- Alert Message -->
            <div id="alertMessage" class="text-xl font-semibold p-4 rounded-lg mb-4 hidden"></div>
            
            <!-- End Message -->
            <div id="endMessage" class="text-3xl font-bold text-red-600 p-6 rounded-lg hidden">
                หมดเวลาสอบแล้ว วางปากกาแล้วส่งข้อสอบได้
            </div>
        </div>
    </div>

    <script>
        let examInterval;
        let examStartTime;
        let examEndTime;
        let isExamActive = false;
        let isFullScreen = false;
        let currentLanguage = 'th';

        // Update end time when duration changes
        document.getElementById('examHours').addEventListener('input', updateEndTime);
        document.getElementById('examMinutes').addEventListener('input', updateEndTime);
        document.getElementById('startTime').addEventListener('input', updateEndTime);

        // Set default start time to next hour
        function setDefaultStartTime() {
            const now = new Date();
            const nextHour = new Date(now);
            nextHour.setHours(now.getHours() + 1, 0, 0, 0);
            const timeString = nextHour.toTimeString().slice(0, 5);
            document.getElementById('startTime').value = timeString;
            updateEndTime();
        }

        // Clock type change
        document.querySelectorAll('input[name="clockType"]').forEach(radio => {
            radio.addEventListener('change', function() {
                if (isExamActive) {
                    toggleClockDisplay();
                    if (isFullScreen) {
                        toggleFullScreenClockDisplay();
                    }
                }
            });
        });

        function updateEndTime() {
            const startTime = document.getElementById('startTime').value;
            const hours = parseInt(document.getElementById('examHours').value) || 0;
            const minutes = parseInt(document.getElementById('examMinutes').value) || 0;
            
            if (startTime) {
                const [startHour, startMinute] = startTime.split(':').map(Number);
                const startDate = new Date();
                startDate.setHours(startHour, startMinute, 0, 0);
                
                const endDate = new Date(startDate.getTime() + (hours * 60 + minutes) * 60000);
                const endTimeString = endDate.toTimeString().slice(0, 5);
                
                document.getElementById('endTime').value = endTimeString;
            }
        }



        function showFullScreen() {
            // Validate inputs
            const courseCode = document.getElementById('courseCode').value;
            const courseName = document.getElementById('courseName').value;
            const courseSection = document.getElementById('courseSection').value;
            const examRoom = document.getElementById('examRoom').value;
            const startTime = document.getElementById('startTime').value;
            
            if (!courseCode || !courseName || !courseSection || !examRoom || !startTime) {
                alert(window.validationMessages[currentLanguage].fillAllFields);
                return;
            }

            // Validate start time (should not be more than 15 minutes in the past)
            const now = new Date();
            const [startHour, startMinute] = startTime.split(':').map(Number);
            const startDate = new Date();
            startDate.setHours(startHour, startMinute, 0, 0);
            
            const timeDiff = startDate - now;
            if (timeDiff < -15 * 60 * 1000) { // More than 15 minutes in the past
                alert(window.validationMessages[currentLanguage].invalidStartTime);
                return;
            }
            
            // Set exam times only if not already set
            if (!isExamActive) {
                const hours = parseInt(document.getElementById('examHours').value) || 0;
                const minutes = parseInt(document.getElementById('examMinutes').value) || 0;
                const totalMinutes = hours * 60 + minutes;
                
                if (totalMinutes === 0) {
                    alert(window.validationMessages[currentLanguage].specifyDuration);
                    return;
                }
                
                // Set exam start time based on input, not current time
                examStartTime = new Date(startDate);
                examEndTime = new Date(startDate.getTime() + totalMinutes * 60000);
                
                isExamActive = true;
            }
            
            isFullScreen = true;
            
            // Copy data to full screen
            document.getElementById('fullScreenCourseCode').textContent = courseCode;
            document.getElementById('fullScreenCourseName').textContent = courseName;
            document.getElementById('fullScreenCourseSection').textContent = courseSection;
            document.getElementById('fullScreenRoom').textContent = examRoom;
            document.getElementById('fullScreenStartTime').textContent = examStartTime.toTimeString().slice(0, 5);
            document.getElementById('fullScreenEndTime').textContent = examEndTime.toTimeString().slice(0, 5);
            
            // Copy additional info
            const additionalInfo = document.getElementById('additionalInfo').value.trim();
            const fullScreenAdditionalInfo = document.getElementById('fullScreenAdditionalInfo');
            if (additionalInfo) {
                fullScreenAdditionalInfo.innerHTML = additionalInfo.replace(/\n/g, '<br>');
                fullScreenAdditionalInfo.classList.remove('hidden');
            } else {
                fullScreenAdditionalInfo.classList.add('hidden');
            }
            
            // Copy to analog version
            document.getElementById('fullScreenCourseCodeAnalog').textContent = courseCode;
            document.getElementById('fullScreenCourseNameAnalog').textContent = courseName;
            document.getElementById('fullScreenCourseSectionAnalog').textContent = courseSection;
            document.getElementById('fullScreenRoomAnalog').textContent = examRoom;
            document.getElementById('fullScreenStartTimeAnalog').textContent = examStartTime.toTimeString().slice(0, 5);
            document.getElementById('fullScreenEndTimeAnalog').textContent = examEndTime.toTimeString().slice(0, 5);
            
            // Copy additional info to analog version
            const fullScreenAdditionalInfoAnalog = document.getElementById('fullScreenAdditionalInfoAnalog');
            if (additionalInfo) {
                fullScreenAdditionalInfoAnalog.innerHTML = additionalInfo.replace(/\n/g, '<br>');
                fullScreenAdditionalInfoAnalog.classList.remove('hidden');
            } else {
                fullScreenAdditionalInfoAnalog.classList.add('hidden');
            }
            
            // No longer using browser fullscreen API - using overlay instead
            
            // Show full screen display
            document.getElementById('fullScreenDisplay').classList.remove('hidden');
            
            // Toggle clock display for full screen
            toggleFullScreenClockDisplay();
            
            // Update toggle button text based on current mode
            updateToggleButtonText();
            
            // Start timer only if not already running
            if (!examInterval) {
                examInterval = setInterval(updateExamDisplay, 1000);
            }
            updateExamDisplay();
        }

        function hideFullScreen() {
            isFullScreen = false;
            
            // Hide display immediately
            document.getElementById('fullScreenDisplay').classList.add('hidden');
            
            // Reset background color
            const mainBody = document.getElementById('mainBody');
            mainBody.className = 'min-h-screen transition-colors duration-500';
            
            // Hide messages
            document.getElementById('fullScreenEndMessage').classList.add('hidden');
            document.getElementById('fullScreenAlertMessage').classList.add('hidden');
            document.getElementById('fullScreenAlertMessageAnalog').classList.add('hidden');
            
            // Reset exam state - stop timer and clear exam data
            if (examInterval) {
                clearInterval(examInterval);
                examInterval = null;
            }
            
            isExamActive = false;
            examStartTime = null;
            examEndTime = null;
            
            // Keep form data intact - don't clear anything
            // This preserves all user input for easy restart
        }

        function toggleClockMode() {
            // Get current clock type
            const currentClockType = document.querySelector('input[name="clockType"]:checked').value;
            
            // Toggle to the other type
            if (currentClockType === 'digital') {
                document.querySelector('input[name="clockType"][value="analog"]').checked = true;
            } else {
                document.querySelector('input[name="clockType"][value="digital"]').checked = true;
            }
            
            // Update the display and button text
            toggleFullScreenClockDisplay();
            updateToggleButtonText();
        }

        function updateToggleButtonText() {
            const currentClockType = document.querySelector('input[name="clockType"]:checked').value;
            const toggleButton = document.getElementById('clockModeToggleText');
            
            if (currentClockType === 'digital') {
                toggleButton.textContent = window.validationMessages[currentLanguage].switchToAnalog;
                toggleButton.setAttribute('data-lang-th', 'เปลี่ยนเป็นอนาล็อก');
                toggleButton.setAttribute('data-lang-en', 'Switch to Analog');
            } else {
                toggleButton.textContent = window.validationMessages[currentLanguage].switchToDigital;
                toggleButton.setAttribute('data-lang-th', 'เปลี่ยนเป็นดิจิตอล');
                toggleButton.setAttribute('data-lang-en', 'Switch to Digital');
            }
        }

        function endExam() {
            // Stop the exam completely
            isExamActive = false;
            isFullScreen = false;
            
            // Stop timer
            if (examInterval) {
                clearInterval(examInterval);
                examInterval = null;
            }
            
            // No longer using browser fullscreen API
            
            // Hide fullscreen display
            document.getElementById('fullScreenDisplay').classList.add('hidden');
            
            // Reset background color
            const mainBody = document.getElementById('mainBody');
            mainBody.className = 'min-h-screen transition-colors duration-500';
            
            // Hide messages
            document.getElementById('fullScreenEndMessage').classList.add('hidden');
            document.getElementById('fullScreenAlertMessage').classList.add('hidden');
            document.getElementById('fullScreenAlertMessageAnalog').classList.add('hidden');
            
            // Reset exam times
            examStartTime = null;
            examEndTime = null;
            
            // Clear form fields (except alert settings)
            document.getElementById('courseCode').value = '';
            document.getElementById('courseName').value = '';
            document.getElementById('courseSection').value = '';
            document.getElementById('examRoom').value = '';
            document.getElementById('startTime').value = '';
            document.getElementById('examHours').value = '2';
            document.getElementById('examMinutes').value = '0';
            document.getElementById('endTime').value = '';
            
            // Set default start time
            setDefaultStartTime();
        }

        function toggleFullScreenClockDisplay() {
            const clockType = document.querySelector('input[name="clockType"]:checked').value;
            const digitalClock = document.getElementById('fullScreenDigitalClock');
            const analogClock = document.getElementById('fullScreenAnalogClock');
            
            if (clockType === 'digital') {
                digitalClock.classList.remove('hidden');
                analogClock.classList.add('hidden');
            } else {
                digitalClock.classList.add('hidden');
                analogClock.classList.remove('hidden');
            }
        }

        function toggleClockDisplay() {
            const clockType = document.querySelector('input[name="clockType"]:checked').value;
            const digitalClock = document.getElementById('digitalClock');
            const analogClock = document.getElementById('analogClock');
            
            if (clockType === 'digital') {
                digitalClock.classList.remove('hidden');
                analogClock.classList.add('hidden');
            } else {
                digitalClock.classList.add('hidden');
                analogClock.classList.remove('hidden');
            }
        }

        function updateExamDisplay() {
            const now = new Date();
            
            // Check if exam hasn't started yet
            if (now < examStartTime) {
                const timeToStart = examStartTime - now;
                const hours = Math.floor(timeToStart / (1000 * 60 * 60));
                const minutes = Math.floor((timeToStart % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeToStart % (1000 * 60)) / 1000);
                
                const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Show waiting message
                document.getElementById('timeRemaining').textContent = timeString;
                document.getElementById('fullScreenTimeRemaining').textContent = timeString;
                
                // Update analog version time remaining
                const analogTimeElement = document.getElementById('fullScreenTimeRemainingAnalog');
                if (analogTimeElement) {
                    analogTimeElement.textContent = timeString;
                }
                
                // Change the header text to indicate waiting
                const digitalClockHeader = document.getElementById('timeRemainingHeader');
                const analogClockHeader = document.getElementById('timeRemainingHeaderAnalog');
                if (digitalClockHeader) digitalClockHeader.textContent = window.validationMessages[currentLanguage].beforeExamStarts;
                if (analogClockHeader) analogClockHeader.textContent = window.validationMessages[currentLanguage].beforeExamStarts;
                
                // Update analog clock
                updateAnalogClock();
                updateFullScreenAnalogClock();
                
                // Hide alert messages while waiting
                document.getElementById('alertMessage').classList.add('hidden');
                document.getElementById('fullScreenAlertMessage').classList.add('hidden');
                document.getElementById('fullScreenAlertMessageAnalog').classList.add('hidden');
                
                // Keep normal background
                const mainBody = document.getElementById('mainBody');
                mainBody.className = 'min-h-screen transition-colors duration-500';
                document.getElementById('fullScreenDisplay').className = 'fixed inset-0 z-50 bg-green-800';
                
                return;
            }
            
            // Exam has started - show remaining time
            const timeRemaining = examEndTime - now;
            
            // Change header text back to remaining time
            const digitalClockHeader = document.getElementById('timeRemainingHeader');
            const analogClockHeader = document.getElementById('timeRemainingHeaderAnalog');
            if (digitalClockHeader) digitalClockHeader.textContent = window.validationMessages[currentLanguage].timeRemaining;
            if (analogClockHeader) analogClockHeader.textContent = window.validationMessages[currentLanguage].timeRemaining;
            
            if (timeRemaining <= 0) {
                // Exam ended - hide all content and show end message
                document.getElementById('endMessage').classList.remove('hidden');
                document.getElementById('fullScreenEndMessage').classList.remove('hidden');
                
                // Hide all other content in fullscreen
                document.getElementById('fullScreenDigitalClock').classList.add('hidden');
                document.getElementById('fullScreenAnalogClock').classList.add('hidden');
                
                document.getElementById('alertMessage').classList.add('hidden');
                document.getElementById('fullScreenAlertMessage').classList.add('hidden');
                document.getElementById('fullScreenAlertMessageAnalog').classList.add('hidden');
                return;
            }
            
            // Update digital clock
            const hours = Math.floor(timeRemaining / (1000 * 60 * 60));
            const minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);
            
            const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            document.getElementById('timeRemaining').textContent = timeString;
            document.getElementById('fullScreenTimeRemaining').textContent = timeString;
            
            // Update analog version time remaining
            const analogTimeElement = document.getElementById('fullScreenTimeRemainingAnalog');
            if (analogTimeElement) {
                analogTimeElement.textContent = timeString;
            }
            
            // Update analog clock
            updateAnalogClock();
            updateFullScreenAnalogClock();
            
            // Check alerts
            const remainingMinutes = Math.ceil(timeRemaining / (1000 * 60));
            const alert1 = parseInt(document.getElementById('alert1').value);
            const alert2 = parseInt(document.getElementById('alert2').value);
            const alert3 = parseInt(document.getElementById('alert3').value);
            
            const alertMessage = document.getElementById('alertMessage');
            const fullScreenAlertMessage = document.getElementById('fullScreenAlertMessage');
            const fullScreenAlertMessageAnalog = document.getElementById('fullScreenAlertMessageAnalog');
            const mainBody = document.getElementById('mainBody');
            const fullScreenDisplay = document.getElementById('fullScreenDisplay');
            
            if (remainingMinutes <= alert3) {
                // Red alert
                mainBody.className = 'min-h-screen bg-red-100 transition-colors duration-500';
                fullScreenDisplay.style.background = 'linear-gradient(135deg, #dc2626, #b91c1c)';
                
                const redAlertText = currentLanguage === 'th' ? `เหลือเวลาอีก ${alert3} นาทีสุดท้าย!` : `${alert3} ${alert3 === 1 ? 'minute' : 'minutes'} remaining!`;
                
                alertMessage.className = 'text-xl font-semibold p-4 rounded-lg mb-4 bg-red-200 text-red-800';
                alertMessage.textContent = redAlertText;
                alertMessage.classList.remove('hidden');
                
                fullScreenAlertMessage.className = 'text-4xl font-bold p-8 rounded-lg mb-8 bg-red-200 text-red-800 drop-shadow-lg';
                fullScreenAlertMessage.textContent = redAlertText;
                fullScreenAlertMessage.classList.remove('hidden');
                
                fullScreenAlertMessageAnalog.className = 'text-4xl font-bold p-8 rounded-lg mb-8 bg-red-200 text-red-800 drop-shadow-lg text-center';
                fullScreenAlertMessageAnalog.textContent = redAlertText;
                fullScreenAlertMessageAnalog.classList.remove('hidden');
            } else if (remainingMinutes <= alert2) {
                // Yellow alert
                mainBody.className = 'min-h-screen bg-yellow-100 transition-colors duration-500';
                fullScreenDisplay.style.background = 'linear-gradient(135deg, #d97706, #b45309)';
                
                const yellowAlertText = currentLanguage === 'th' ? `เหลือเวลาอีก ${alert2} นาทีสุดท้าย!` : `${alert2} ${alert2 === 1 ? 'minute' : 'minutes'} remaining!`;
                
                alertMessage.className = 'text-xl font-semibold p-4 rounded-lg mb-4 bg-yellow-200 text-yellow-800';
                alertMessage.textContent = yellowAlertText;
                alertMessage.classList.remove('hidden');
                
                fullScreenAlertMessage.className = 'text-4xl font-bold p-8 rounded-lg mb-8 bg-yellow-200 text-yellow-800 drop-shadow-lg';
                fullScreenAlertMessage.textContent = yellowAlertText;
                fullScreenAlertMessage.classList.remove('hidden');
                
                fullScreenAlertMessageAnalog.className = 'text-4xl font-bold p-8 rounded-lg mb-8 bg-yellow-200 text-yellow-800 drop-shadow-lg text-center';
                fullScreenAlertMessageAnalog.textContent = yellowAlertText;
                fullScreenAlertMessageAnalog.classList.remove('hidden');
            } else if (remainingMinutes <= alert1) {
                // Green alert
                mainBody.className = 'min-h-screen bg-green-100 transition-colors duration-500';
                fullScreenDisplay.style.background = 'linear-gradient(135deg, #059669, #047857)';
                
                const greenAlertText = currentLanguage === 'th' ? 'นิสิตสามารถส่งข้อสอบ และ ออกจากห้องสอบได้' : 'Students may submit and leave the exam room';
                
                alertMessage.className = 'text-xl font-semibold p-4 rounded-lg mb-4 bg-green-200 text-green-800';
                alertMessage.textContent = greenAlertText;
                alertMessage.classList.remove('hidden');
                
                fullScreenAlertMessage.className = 'text-4xl font-bold p-8 rounded-lg mb-8 bg-green-200 text-green-800 drop-shadow-lg';
                fullScreenAlertMessage.textContent = greenAlertText;
                fullScreenAlertMessage.classList.remove('hidden');
                
                fullScreenAlertMessageAnalog.className = 'text-4xl font-bold p-8 rounded-lg mb-8 bg-green-200 text-green-800 drop-shadow-lg text-center';
                fullScreenAlertMessageAnalog.textContent = greenAlertText;
                fullScreenAlertMessageAnalog.classList.remove('hidden');
            } else {
                // Normal state
                mainBody.className = 'min-h-screen transition-colors duration-500';
                fullScreenDisplay.className = 'fixed inset-0 z-50 bg-green-800';
                alertMessage.classList.add('hidden');
                fullScreenAlertMessage.classList.add('hidden');
                fullScreenAlertMessageAnalog.classList.add('hidden');
            }
        }

        function updateAnalogClock() {
            const now = new Date();
            const hours = now.getHours() % 12;
            const minutes = now.getMinutes();
            const seconds = now.getSeconds();
            
            const hourAngle = (hours * 30) + (minutes * 0.5);
            const minuteAngle = minutes * 6;
            const secondAngle = seconds * 6;
            
            document.getElementById('hourHand').style.transform = `rotate(${hourAngle}deg)`;
            document.getElementById('minuteHand').style.transform = `rotate(${minuteAngle}deg)`;
            document.getElementById('secondHand').style.transform = `rotate(${secondAngle}deg)`;
            
            document.getElementById('currentTime').textContent = now.toTimeString().slice(0, 8);
        }

        function updateFullScreenAnalogClock() {
            const now = new Date();
            const hours = now.getHours() % 12;
            const minutes = now.getMinutes();
            const seconds = now.getSeconds();
            
            const hourAngle = (hours * 30) + (minutes * 0.5);
            const minuteAngle = minutes * 6;
            const secondAngle = seconds * 6;
            
            const fullScreenHourHand = document.getElementById('fullScreenHourHand');
            const fullScreenMinuteHand = document.getElementById('fullScreenMinuteHand');
            const fullScreenSecondHand = document.getElementById('fullScreenSecondHand');
            
            if (fullScreenHourHand) fullScreenHourHand.style.transform = `rotate(${hourAngle}deg)`;
            if (fullScreenMinuteHand) fullScreenMinuteHand.style.transform = `rotate(${minuteAngle}deg)`;
            if (fullScreenSecondHand) fullScreenSecondHand.style.transform = `rotate(${secondAngle}deg)`;
            
            const fullScreenCurrentTime = document.getElementById('fullScreenCurrentTime');
            if (fullScreenCurrentTime) fullScreenCurrentTime.textContent = now.toTimeString().slice(0, 8);
        }

        // Language switching function
        function setLanguage(lang) {
            currentLanguage = lang;
            
            // Update button states
            const thBtn = document.getElementById('langTh');
            const enBtn = document.getElementById('langEn');
            
            if (lang === 'th') {
                thBtn.className = 'px-4 py-2 rounded-md bg-blue-600 text-white font-medium transition-colors';
                enBtn.className = 'px-4 py-2 rounded-md text-gray-600 font-medium transition-colors hover:bg-gray-300';
            } else {
                thBtn.className = 'px-4 py-2 rounded-md text-gray-600 font-medium transition-colors hover:bg-gray-300';
                enBtn.className = 'px-4 py-2 rounded-md bg-blue-600 text-white font-medium transition-colors';
            }
            
            // Update all text elements
            const elements = document.querySelectorAll('[data-lang-th][data-lang-en]');
            elements.forEach(element => {
                const text = element.getAttribute(`data-lang-${lang}`);
                if (text) {
                    if (element.innerHTML.includes('<br>')) {
                        element.innerHTML = text;
                    } else {
                        element.textContent = text;
                    }
                }
            });
            
            // Update placeholders
            const inputs = document.querySelectorAll('[data-placeholder-th][data-placeholder-en]');
            inputs.forEach(input => {
                const placeholder = input.getAttribute(`data-placeholder-${lang}`);
                if (placeholder) {
                    input.placeholder = placeholder;
                }
            });
            
            // Update toggle button text
            updateToggleButtonText();
            
            // Update validation messages
            updateValidationMessages();
        }
        
        function updateValidationMessages() {
            // Store validation messages in both languages
            window.validationMessages = {
                th: {
                    fillAllFields: 'กรุณากรอกข้อมูลให้ครบถ้วน',
                    invalidStartTime: 'เวลาเริ่มสอบไม่ควรน้อยกว่าเวลาปัจจุบันเกิน 15 นาที',
                    specifyDuration: 'กรุณาระบุระยะเวลาสอบ',
                    studentsCanSubmit: 'นิสิตสามารถส่งข้อสอบ และ ออกจากห้องสอบได้',
                    minutesRemaining: 'นาทีสุดท้าย!',
                    beforeExamStarts: 'เวลาก่อนเริ่มสอบ',
                    timeRemaining: 'เวลาสอบที่เหลืออยู่',
                    switchToAnalog: 'เปลี่ยนเป็นอนาล็อก',
                    switchToDigital: 'เปลี่ยนเป็นดิจิตอล'
                },
                en: {
                    fillAllFields: 'Please fill in all required fields',
                    invalidStartTime: 'Start time should not be more than 15 minutes in the past',
                    specifyDuration: 'Please specify exam duration',
                    studentsCanSubmit: 'Students may submit and leave the exam room',
                    minutesRemaining: 'minutes remaining!',
                    beforeExamStarts: 'Time Before Exam Starts',
                    timeRemaining: 'Time Remaining',
                    switchToAnalog: 'Switch to Analog',
                    switchToDigital: 'Switch to Digital'
                }
            };
        }

        // Initialize
        updateValidationMessages();
        setDefaultStartTime();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9810b4f8921c7328',t:'MTc1ODE5NzA3OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
